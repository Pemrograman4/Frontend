<!DOCTYPE html>
<html lang="id">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Tambah Data Pembayaran</title>
    <link rel="stylesheet" href="add-edit.css" />
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css"
    />
    <script
      src="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/js/all.min.js"
      integrity="sha512-yFjZbTYRCJodnuyGlsKamNE/LlEaEAxSUDe5+u61mV8zzqJVFOH7TnULE2/PP/l5vKWpUNnF4VGVkXh3MjgLsg=="
      crossorigin="anonymous"
      referrerpolicy="no-referrer"
    ></script>

    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link
      href="https://fonts.googleapis.com/css2?family=Poppins:ital,wght@0,100;0,200;0,300;0,400;0,500;0,600;0,700;0,800;0,900;1,100;1,200;1,300;1,400;1,500;1,600;1,700;1,800;1,900&family=Ubuntu:ital,wght@0,300;0,400;0,500;0,700;1,300;1,400;1,500;1,700&display=swap"
      rel="stylesheet"
    />
  </head>
    <title>Edit Kursus</title>
  <body>
    <header class="header">
      <a href="javascript:history.back()"><i class="fa-solid fa-arrow-left"></i></a>
      <div class="right-section">
        <h1 class="title">FASFADE Institute</h1>
        <img src="/logo_only.png" alt="FASFADE Logo" class="logo" />
      </div>
    </header>
    <div class="container">
      <h2>Edit Kursus</h2>
      <!-- Form input data program kursus -->
      <form id="courseForm">
        <span><label for="programId">ID Program:</label>
            <input type="text" id="programId" required readonly><br><br></span>
        
        <span><label for="programName">Nama Program:</label>
            <input type="text" id="programName" required><br><br></span>
        
        <span><label for="duration">Durasi Program (bulan):</label>
            <input type="number" id="duration" required><br><br></span>
        
        <span><label for="programCost">Biaya Kursus:</label>
            <input type="number" id="programCost" min="100000" step="10000" value="100000" required>
            <span id="costValue">Rp 100.000</span><br><br></span>
        
        <span><label for="description">Deskripsi Program:</label>
            <textarea id="description" required></textarea><br><br></span>
        
        <button type="submit" id="submitButton">Simpan Program</button>
    </form>       
      <!-- Bottom Navigation -->
    <nav class="nav-bottom">
      <i
        class="fa-solid fa-house"
        onclick="window.location.href='/index.html'"
      ></i>
      <i
        class="fa-solid fa-plus-circle active-plus"
        onclick="window.location.href='#'"
      ></i>
      <i class="fa-solid fa-user active"></i>
    </nav>
    </div>

    <script>
      const costInput = document.getElementById("programCost"); // Input biaya program
      const costValue = document.getElementById("costValue");
      const durationInput = document.getElementById("duration");
      const courseForm = document.getElementById("editCourseForm");
      const submitButton = document.querySelector("button");
    
      // Fungsi untuk menghitung total biaya berdasarkan durasi dan biaya per bulan
      function updateTotalCost() {
        const duration = parseInt(durationInput.value) || 0;
        const costPerProgram = parseInt(costInput.value) || 0;
        const totalCost = costPerProgram * duration;
        costValue.textContent = `Rp ${totalCost.toLocaleString()}`;
      }
    
      // Menampilkan nilai dari input biaya secara dinamis
      costInput.addEventListener("input", function () {
        updateTotalCost(); // Memperbarui biaya total saat biaya program berubah
      });
    
      // Memuat data kursus untuk pengeditan jika parameter 'edit' ada di URL
      function loadCourseForEditing() {
        const urlParams = new URLSearchParams(window.location.search);
        const editIndex = urlParams.get("edit");
    
        if (editIndex !== null) {
          let courses = JSON.parse(localStorage.getItem("courses")) || [];
          const course = courses[editIndex];
    
          if (course) {
            // Mengisi form dengan data kursus yang akan diedit
            document.getElementById("programId").value = course.programId;
            document.getElementById("programName").value = course.programName;
            document.getElementById("duration").value = course.duration;
            costInput.value = course.cost / course.duration; // Set biaya per program (biaya total / durasi)
            costValue.textContent = `Rp ${course.cost.toLocaleString()}`;
            document.getElementById("description").value = course.description;
    
            // Mengubah teks tombol submit menjadi 'Selesai Perubahan'
            submitButton.textContent = "Selesai Perubahan";
    
            // Memperbarui biaya total saat halaman pertama kali dimuat
            updateTotalCost();
          } else {
            alert("Data kursus tidak ditemukan!");
            window.location.href = "list_courses.html"; // Redirect jika data kursus tidak ditemukan
          }
        } else {
          alert("ID kursus tidak ditemukan!");
          window.location.href = "list_courses.html"; // Redirect jika tidak ada parameter edit
        }
      }
    
      // Menyimpan data setelah pengeditan
      courseForm.addEventListener("submit", function (event) {
        event.preventDefault();
    
        const programId = document.getElementById("programId").value;
        const programName = document.getElementById("programName").value;
        const duration = document.getElementById("duration").value;
        const cost = costInput.value * duration; // Total biaya = biaya per program * durasi
        const description = document.getElementById("description").value;
    
        if (!programId || !programName || !duration || !description) {
          alert("Semua kolom wajib diisi!");
          return;
        }
    
        const course = {
          programId,
          programName,
          duration,
          cost,
          description,
        };
    
        let courses = JSON.parse(localStorage.getItem("courses")) || [];
        const urlParams = new URLSearchParams(window.location.search);
        const editIndex = urlParams.get("edit");
    
        if (editIndex !== null) {
          courses[editIndex] = course; // Update data kursus yang dipilih
        } else {
          // Tambahkan kursus baru ke array jika bukan edit
          courses.push(course);
        }
    
        // Menyimpan kembali data yang telah diubah ke localStorage
        localStorage.setItem("courses", JSON.stringify(courses));
    
        // Mengarahkan kembali ke halaman daftar kursus setelah pengeditan
        window.location.href = "list_courses.html";
      });
    
      // Memuat kursus ketika halaman pertama kali dimuat
      loadCourseForEditing();
    
      // Menangani tombol Batal
      const cancelButton = document.getElementById("cancelButton");
      if (cancelButton) {
        cancelButton.addEventListener("click", function () {
          // Mengarahkan kembali ke halaman daftar kursus tanpa menyimpan perubahan
          window.location.href = "list_courses.html";
        });
      }
    </script>
    
      
  </body>
</html>