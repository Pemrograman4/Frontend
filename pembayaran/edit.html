<!DOCTYPE html>
<html lang="id">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Edit Data Pembayaran</title>
    <link rel="stylesheet" href="add-edit.css" />
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css"
    />
    <script
      src="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/js/all.min.js"
      integrity="sha512-yFjZbTYRCJodnuyGlsKamNE/LlEaEAxSUDe5+u61mV8zzqJVFOH7TnULE2/PP/l5vKWpUNnF4VGVkXh3MjgLsg=="
      crossorigin="anonymous"
      referrerpolicy="no-referrer"
    ></script>

    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link
      href="https://fonts.googleapis.com/css2?family=Poppins:ital,wght@0,100;0,200;0,300;0,400;0,500;0,600;0,700;0,800;0,900;1,100;1,200;1,300;1,400;1,500;1,600;1,700;1,800;1,900&family=Ubuntu:ital,wght@0,300;0,400;0,500;0,700;1,300;1,400;1,500;1,700&display=swap"
      rel="stylesheet"
    />
  </head>
  <body>
    <header class="header">
      <a href="javascript:history.back()"><i class="fa-solid fa-arrow-left"></i></a>
      <div class="right-section">
        <h1 class="title">FASFADE Institute</h1>
        <img src="/logo_only.png" alt="FASFADE Logo" class="logo" />
      </div>
    </header>
    <div class="container">
      <h1>Edit Data Pembayaran</h1>
      <form id="formEditPembayaran">
        <input type="hidden" id="idPembayaran" />
        <span>
        <label for="idSiswa">Nama Siswa</label>
        <select id="idSiswa" required>
          <option value="">Pilih Siswa</option>
        </select></span>
        <span>
        <label for="idTagihan">ID Tagihan:</label>
        <select id="idTagihan" required>
          <option value="">Pilih Tagihan</option>
        </select></span>
        <span>
        <label for="tanggalPembayaran">Tanggal Pembayaran:</label>
        <input type="date" id="tanggalPembayaran" required /></span>
        <span>
        <label for="jumlahPembayaran">Jumlah Pembayaran:</label>
        <input type="number" id="jumlahPembayaran" required /></span>
        <span>
        <label for="metodePembayaran">Metode Pembayaran:</label>
        <select id="metodePembayaran" required>
          <option value="Transfer Bank">Transfer Bank</option>
          <option value="Tunai">Tunai</option>
        </select></span>
        <button type="submit">Simpan</button>
      </form>
    </div>
    <!-- Bottom Navigation -->
    <nav class="nav-bottom">
      <i
        class="fa-solid fa-house"
        onclick="window.location.href='/index.html'"
      ></i>
      <i
        class="fa-solid fa-plus-circle active-plus"
        onclick="window.location.href='#'"
      ></i>
      <i class="fa-solid fa-user active"></i>
    </nav>
    <script>
      // Fungsi format Rupiah
      function formatRupiah(angka) {
        return new Intl.NumberFormat("id-ID", {
          style: "currency",
          currency: "IDR",
          minimumFractionDigits: 0,
        }).format(angka);
      }

      // Fungsi format Tanggal ke format Indonesia
      function formatTanggalIndonesia(tanggal) {
        const date = new Date(tanggal);
        const options = { day: "2-digit", month: "long", year: "numeric" };
        return date.toLocaleDateString("id-ID", options);
      }

      // Fungsi untuk mengisi dropdown
      function populateSelects() {
        const siswaData = JSON.parse(localStorage.getItem("siswaData")) || [];
        const tagihanData = JSON.parse(localStorage.getItem("tagihanData")) || [];

        // Isi dropdown ID Siswa
        const idSiswaSelect = document.getElementById("idSiswa");
        siswaData.forEach((siswa) => {
          const option = document.createElement("option");
          option.value = siswa.id;
          option.textContent = siswa.nama;
          idSiswaSelect.appendChild(option);
        });

        // Isi dropdown ID Tagihan berdasarkan ID Siswa yang dipilih
        const idTagihanSelect = document.getElementById("idTagihan");
        const idSiswaDipilih = document.getElementById("idSiswa").value;
        idTagihanSelect.innerHTML = '<option value="">Pilih Tagihan</option>'; // Reset options
        tagihanData
          .filter((tagihan) => tagihan.idSiswa === idSiswaDipilih)
          .forEach((tagihan) => {
            const option = document.createElement("option");
            option.value = tagihan.id;
            option.textContent = tagihan.nama;
            idTagihanSelect.appendChild(option);
          });
      }

      // Memanggil fungsi untuk mengisi dropdown saat halaman dimuat
      window.onload = populateSelects;

      // Memilih pembayaran berdasarkan id dari URL
      const urlParams = new URLSearchParams(window.location.search);
      const idPembayaran = urlParams.get("id");

      let pembayaranData = JSON.parse(localStorage.getItem("pembayaranData"));
      const pembayaran = pembayaranData.find(
        (data) => data.idPembayaran == idPembayaran
      );

      if (pembayaran) {
        document.getElementById("idPembayaran").value = pembayaran.idPembayaran;
        document.getElementById("idSiswa").value = pembayaran.idSiswa;
        document.getElementById("idTagihan").value = pembayaran.idTagihan;
        document.getElementById("tanggalPembayaran").value = pembayaran.tanggalPembayaran;
        document.getElementById("jumlahPembayaran").value = pembayaran.jumlahPembayaran;
        document.getElementById("metodePembayaran").value = pembayaran.metodePembayaran;
      }

      document
        .getElementById("formEditPembayaran")
        .addEventListener("submit", function (event) {
          event.preventDefault();

          pembayaran.idSiswa = document.getElementById("idSiswa").value;
          pembayaran.idTagihan = document.getElementById("idTagihan").value;
          pembayaran.tanggalPembayaran = document.getElementById("tanggalPembayaran").value;
          pembayaran.jumlahPembayaran = document.getElementById("jumlahPembayaran").value;
          pembayaran.metodePembayaran = document.getElementById("metodePembayaran").value;

          localStorage.setItem("pembayaranData", JSON.stringify(pembayaranData));

          Swal.fire({
            title: "Berhasil!",
            text: "Data pembayaran berhasil diperbarui.",
            icon: "success",
          }).then(() => {
            window.location.href = "index.html";
          });
        });
    </script>
  </body>
</html>